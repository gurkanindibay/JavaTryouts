{
    "id":  null,
    "title":  "Library Business Metrics",
    "tags":  [
                 "business",
                 "library",
                 "books",
                 "collections-challenge"
             ],
    "style":  "dark",
    "timezone":  "browser",
    "refresh":  "30s",
    "time":  {
                 "from":  "now-1h",
                 "to":  "now"
             },
    "panels":  [
                   {
                       "id":  1,
                       "title":  "Total Books Borrowed",
                       "type":  "stat",
                       "gridPos":  {
                                       "h":  8,
                                       "w":  6,
                                       "x":  0,
                                       "y":  0
                                   },
                       "targets":  [
                                       {
                                           "expr":  "library_books_borrowed_total{application=\"collections-kafka-challenge\"}",
                                           "legendFormat":  "Total Borrowed"
                                       }
                                   ],
                       "fieldConfig":  {
                                           "defaults":  {
                                                            "color":  {
                                                                          "mode":  "thresholds"
                                                                      },
                                                            "thresholds":  {
                                                                               "steps":  [
                                                                                             {
                                                                                                 "color":  "green",
                                                                                                 "value":  0
                                                                                             },
                                                                                             {
                                                                                                 "color":  "yellow",
                                                                                                 "value":  50
                                                                                             },
                                                                                             {
                                                                                                 "color":  "red",
                                                                                                 "value":  100
                                                                                             }
                                                                                         ]
                                                                           },
                                                            "unit":  "short"
                                                        }
                                       }
                   },
                   {
                       "id":  2,
                       "title":  "Book Borrow Rate",
                       "type":  "stat",
                       "gridPos":  {
                                       "h":  8,
                                       "w":  6,
                                       "x":  6,
                                       "y":  0
                                   },
                       "targets":  [
                                       {
                                           "expr":  "rate(library_books_borrowed_total{application=\"collections-kafka-challenge\"}[5m]) * 60",
                                           "legendFormat":  "Borrows/min"
                                       }
                                   ],
                       "fieldConfig":  {
                                           "defaults":  {
                                                            "color":  {
                                                                          "mode":  "palette-classic"
                                                                      },
                                                            "unit":  "short"
                                                        }
                                       }
                   },
                   {
                       "id":  3,
                       "title":  "Book Operation Duration",
                       "type":  "gauge",
                       "gridPos":  {
                                       "h":  8,
                                       "w":  6,
                                       "x":  12,
                                       "y":  0
                                   },
                       "targets":  [
                                       {
                                           "expr":  "library_borrow_duration_seconds_max{application=\"collections-kafka-challenge\"}",
                                           "legendFormat":  "Max Borrow Duration"
                                       }
                                   ],
                       "fieldConfig":  {
                                           "defaults":  {
                                                            "unit":  "s",
                                                            "min":  0,
                                                            "max":  1,
                                                            "thresholds":  {
                                                                               "steps":  [
                                                                                             {
                                                                                                 "color":  "green",
                                                                                                 "value":  0
                                                                                             },
                                                                                             {
                                                                                                 "color":  "yellow",
                                                                                                 "value":  0.1
                                                                                             },
                                                                                             {
                                                                                                 "color":  "red",
                                                                                                 "value":  0.5
                                                                                             }
                                                                                         ]
                                                                           }
                                                        }
                                       }
                   },
                   {
                       "id":  4,
                       "title":  "Library API Health",
                       "type":  "stat",
                       "gridPos":  {
                                       "h":  8,
                                       "w":  6,
                                       "x":  18,
                                       "y":  0
                                   },
                       "targets":  [
                                       {
                                           "expr":  "sum(rate(http_server_requests_seconds_count{application=\"collections-kafka-challenge\", uri=~\"/api/books.*\", status!~\"4..\"}[5m]))",
                                           "legendFormat":  "Success Rate"
                                       },
                                       {
                                           "expr":  "sum(rate(http_server_requests_seconds_count{application=\"collections-kafka-challenge\", uri=~\"/api/books.*\", status=~\"4..\"}[5m]))",
                                           "legendFormat":  "Error Rate"
                                       }
                                   ],
                       "fieldConfig":  {
                                           "defaults":  {
                                                            "color":  {
                                                                          "mode":  "thresholds"
                                                                      },
                                                            "thresholds":  {
                                                                               "steps":  [
                                                                                             {
                                                                                                 "color":  "green",
                                                                                                 "value":  0
                                                                                             },
                                                                                             {
                                                                                                 "color":  "yellow",
                                                                                                 "value":  1
                                                                                             },
                                                                                             {
                                                                                                 "color":  "red",
                                                                                                 "value":  5
                                                                                             }
                                                                                         ]
                                                                           }
                                                        }
                                       }
                   },
                   {
                       "id":  5,
                       "title":  "Books Borrowed Over Time",
                       "type":  "graph",
                       "gridPos":  {
                                       "h":  8,
                                       "w":  12,
                                       "x":  0,
                                       "y":  8
                                   },
                       "targets":  [
                                       {
                                           "expr":  "library_books_borrowed_total{application=\"collections-kafka-challenge\"}",
                                           "legendFormat":  "Total Books Borrowed"
                                       },
                                       {
                                           "expr":  "rate(library_books_borrowed_total{application=\"collections-kafka-challenge\"}[5m]) * 60",
                                           "legendFormat":  "Borrow Rate (per minute)"
                                       }
                                   ],
                       "yAxes":  [
                                     {
                                         "label":  "Books/Rate",
                                         "min":  0
                                     },
                                     {
                                         "show":  false
                                     }
                                 ]
                   },
                   {
                       "id":  6,
                       "title":  "Book Operation Performance",
                       "type":  "graph",
                       "gridPos":  {
                                       "h":  8,
                                       "w":  12,
                                       "x":  12,
                                       "y":  8
                                   },
                       "targets":  [
                                       {
                                           "expr":  "rate(library_borrow_duration_seconds_count{application=\"collections-kafka-challenge\"}[5m])",
                                           "legendFormat":  "Borrow Operation Rate"
                                       },
                                       {
                                           "expr":  "rate(library_add_book_duration_seconds_count{application=\"collections-kafka-challenge\"}[5m])",
                                           "legendFormat":  "Add Book Operation Rate"
                                       },
                                       {
                                           "expr":  "rate(library_borrow_duration_seconds_sum{application=\"collections-kafka-challenge\"}[5m]) / rate(library_borrow_duration_seconds_count{application=\"collections-kafka-challenge\"}[5m])",
                                           "legendFormat":  "Average Borrow Duration"
                                       },
                                       {
                                           "expr":  "rate(library_add_book_duration_seconds_sum{application=\"collections-kafka-challenge\"}[5m]) / rate(library_add_book_duration_seconds_count{application=\"collections-kafka-challenge\"}[5m])",
                                           "legendFormat":  "Average Add Book Duration"
                                       }
                                   ],
                       "yAxes":  [
                                     {
                                         "label":  "Operations/Duration",
                                         "min":  0
                                     },
                                     {
                                         "show":  false
                                     }
                                 ]
                   },
                   {
                       "id":  7,
                       "title":  "Library API Requests by Endpoint",
                       "type":  "graph",
                       "gridPos":  {
                                       "h":  8,
                                       "w":  12,
                                       "x":  0,
                                       "y":  16
                                   },
                       "targets":  [
                                       {
                                           "expr":  "sum(rate(http_server_requests_seconds_count{application=\"collections-kafka-challenge\", uri=~\"/api/books.*\"}[5m])) by (uri, method)",
                                           "legendFormat":  "{{method}} {{uri}}"
                                       }
                                   ],
                       "yAxes":  [
                                     {
                                         "label":  "Requests/sec",
                                         "min":  0
                                     },
                                     {
                                         "show":  false
                                     }
                                 ]
                   },
                   {
                       "id":  8,
                       "title":  "Library API Response Times",
                       "type":  "graph",
                       "gridPos":  {
                                       "h":  8,
                                       "w":  12,
                                       "x":  12,
                                       "y":  16
                                   },
                       "targets":  [
                                       {
                                           "expr":  "histogram_quantile(0.50, sum(rate(http_server_requests_seconds_bucket{application=\"collections-kafka-challenge\", uri=~\"/api/books.*\"}[5m])) by (le, uri))",
                                           "legendFormat":  "50th - {{uri}}"
                                       },
                                       {
                                           "expr":  "histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket{application=\"collections-kafka-challenge\", uri=~\"/api/books.*\"}[5m])) by (le, uri))",
                                           "legendFormat":  "95th - {{uri}}"
                                       }
                                   ],
                       "yAxes":  [
                                     {
                                         "label":  "Response Time",
                                         "unit":  "s",
                                         "min":  0
                                     },
                                     {
                                         "show":  false
                                     }
                                 ]
                   },
                   {
                       "id":  9,
                       "title":  "Library Inventory and Operations",
                       "type":  "graph",
                       "gridPos":  {
                                       "h":  8,
                                       "w":  12,
                                       "x":  0,
                                       "y":  24
                                   },
                       "targets":  [
                                       {
                                           "expr":  "library_books{application=\"collections-kafka-challenge\"}",
                                           "legendFormat":  "Current Books in Library"
                                       },
                                       {
                                           "expr":  "library_books_added_total{application=\"collections-kafka-challenge\"}",
                                           "legendFormat":  "Total Books Added"
                                       },
                                       {
                                           "expr":  "library_borrow_count{application=\"collections-kafka-challenge\"}",
                                           "legendFormat":  "Total Borrow Count"
                                       }
                                   ],
                       "yAxes":  [
                                     {
                                         "label":  "Count",
                                         "min":  0
                                     },
                                     {
                                         "show":  false
                                     }
                                 ]
                   },
                   {
                       "id":  10,
                       "title":  "Operational Summary",
                       "type":  "table",
                       "gridPos":  {
                                       "h":  8,
                                       "w":  12,
                                       "x":  12,
                                       "y":  24
                                   },
                       "targets":  [
                                       {
                                           "expr":  "library_books_added_total{application=\"collections-kafka-challenge\"}",
                                           "legendFormat":  "Total Books Added",
                                           "format":  "table",
                                           "instant":  true
                                       },
                                       {
                                           "expr":  "library_books_borrowed_total{application=\"collections-kafka-challenge\"}",
                                           "legendFormat":  "Total Books Borrowed",
                                           "format":  "table",
                                           "instant":  true
                                       },
                                       {
                                           "expr":  "library_books{application=\"collections-kafka-challenge\"}",
                                           "legendFormat":  "Current Inventory",
                                           "format":  "table",
                                           "instant":  true
                                       },
                                       {
                                           "expr":  "rate(library_books_borrowed_total{application=\"collections-kafka-challenge\"}[1h]) * 3600",
                                           "legendFormat":  "Hourly Borrow Rate",
                                           "format":  "table",
                                           "instant":  true
                                       },
                                       {
                                           "expr":  "library_borrow_duration_seconds_max{application=\"collections-kafka-challenge\"}",
                                           "legendFormat":  "Max Borrow Time",
                                           "format":  "table",
                                           "instant":  true
                                       },
                                       {
                                           "expr":  "library_add_book_duration_seconds_max{application=\"collections-kafka-challenge\"}",
                                           "legendFormat":  "Max Add Book Time",
                                           "format":  "table",
                                           "instant":  true
                                       }
                                   ]
                   },
                   {
                       "id":  11,
                       "title":  "Total Books Added",
                       "type":  "stat",
                       "gridPos":  {
                                       "h":  4,
                                       "w":  6,
                                       "x":  0,
                                       "y":  32
                                   },
                       "targets":  [
                                       {
                                           "expr":  "library_books_added_total{application=\"collections-kafka-challenge\"}",
                                           "legendFormat":  "Total Added"
                                       }
                                   ],
                       "fieldConfig":  {
                                           "defaults":  {
                                                            "color":  {
                                                                          "mode":  "thresholds"
                                                                      },
                                                            "thresholds":  {
                                                                               "steps":  [
                                                                                             {
                                                                                                 "color":  "blue",
                                                                                                 "value":  0
                                                                                             },
                                                                                             {
                                                                                                 "color":  "green",
                                                                                                 "value":  10
                                                                                             },
                                                                                             {
                                                                                                 "color":  "yellow",
                                                                                                 "value":  50
                                                                                             }
                                                                                         ]
                                                                           },
                                                            "unit":  "short"
                                                        }
                                       }
                   },
                   {
                       "id":  12,
                       "title":  "Current Library Inventory",
                       "type":  "stat",
                       "gridPos":  {
                                       "h":  4,
                                       "w":  6,
                                       "x":  6,
                                       "y":  32
                                   },
                       "targets":  [
                                       {
                                           "expr":  "library_books{application=\"collections-kafka-challenge\"}",
                                           "legendFormat":  "Books Available"
                                       }
                                   ],
                       "fieldConfig":  {
                                           "defaults":  {
                                                            "color":  {
                                                                          "mode":  "thresholds"
                                                                      },
                                                            "thresholds":  {
                                                                               "steps":  [
                                                                                             {
                                                                                                 "color":  "red",
                                                                                                 "value":  0
                                                                                             },
                                                                                             {
                                                                                                 "color":  "yellow",
                                                                                                 "value":  5
                                                                                             },
                                                                                             {
                                                                                                 "color":  "green",
                                                                                                 "value":  10
                                                                                             }
                                                                                         ]
                                                                           },
                                                            "unit":  "short"
                                                        }
                                       }
                   },
                   {
                       "id":  13,
                       "title":  "Average Operation Times",
                       "type":  "stat",
                       "gridPos":  {
                                       "h":  4,
                                       "w":  12,
                                       "x":  12,
                                       "y":  32
                                   },
                       "targets":  [
                                       {
                                           "expr":  "rate(library_add_book_duration_seconds_sum{application=\"collections-kafka-challenge\"}[5m]) / rate(library_add_book_duration_seconds_count{application=\"collections-kafka-challenge\"}[5m])",
                                           "legendFormat":  "Avg Add Book Time"
                                       },
                                       {
                                           "expr":  "rate(library_borrow_duration_seconds_sum{application=\"collections-kafka-challenge\"}[5m]) / rate(library_borrow_duration_seconds_count{application=\"collections-kafka-challenge\"}[5m])",
                                           "legendFormat":  "Avg Borrow Time"
                                       }
                                   ],
                       "fieldConfig":  {
                                           "defaults":  {
                                                            "color":  {
                                                                          "mode":  "palette-classic"
                                                                      },
                                                            "unit":  "s"
                                                        }
                                       }
                   }
               ]
}
